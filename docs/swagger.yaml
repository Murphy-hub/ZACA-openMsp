definitions:
  ca.IntermediateObject:
    properties:
      certs:
        items:
          $ref: '#/definitions/schema.FullCert'
        type: array
      children:
        items:
          $ref: '#/definitions/ca.IntermediateObject'
        type: array
      current:
        type: boolean
      metadata:
        $ref: '#/definitions/schema.CaMetadata'
    type: object
  ca.OverallCertsCountItem:
    properties:
      role:
        description: 类别
        type: string
      total:
        description: 证书总数
        type: integer
      units_count:
        description: 服务数量
        type: integer
    type: object
  ca.OverallCertsCountResponse:
    properties:
      certs:
        items:
          $ref: '#/definitions/ca.OverallCertsCountItem'
        type: array
      total:
        type: integer
    type: object
  ca.OverallExpiryCertsResponse:
    properties:
      expiry_certs:
        items:
          $ref: '#/definitions/ca.OverallExpiryGroup'
        type: array
      expiry_total:
        type: integer
    type: object
  ca.OverallExpiryGroup:
    properties:
      count:
        type: integer
      name:
        type: string
    type: object
  ca.OverallUnitsEnableItem:
    properties:
      certs_count:
        type: integer
      units_count:
        type: integer
    type: object
  ca.OverallUnitsEnableStatus:
    properties:
      disable:
        $ref: '#/definitions/ca.OverallUnitsEnableItem'
      enable:
        $ref: '#/definitions/ca.OverallUnitsEnableItem'
    type: object
  ca.RoleProfile:
    properties:
      auth_key:
        type: string
      expiry_duration:
        type: string
      expiry_string:
        type: string
      is_ca:
        type: boolean
      name:
        type: string
      usages:
        items:
          type: string
        type: array
    type: object
  ca.WorkloadUnit:
    properties:
      first_issued_at:
        description: 首次签发证书日期
        type: string
      forbidden:
        description: 是否被禁止
        type: boolean
      role:
        type: string
      unique_id:
        type: string
      valid_num:
        description: 有效证书数量
        type: integer
    type: object
  certleaf.LeafCert:
    properties:
      aki:
        type: string
      cert_info:
        $ref: '#/definitions/schema.Certificate'
      cert_str:
        description: 展示证书的详细信息
        type: string
      cn:
        type: string
      expiry:
        type: string
      issued_at:
        type: string
      issuer_cert:
        $ref: '#/definitions/certleaf.LeafCert'
      not_before:
        type: string
      o:
        type: string
      ou:
        type: string
      revoked_at:
        type: string
      role:
        type: string
      sn:
        type: string
      status:
        example: good
        type: string
      unique_id:
        type: string
    type: object
  certleaf.RootCertChains:
    properties:
      root:
        $ref: '#/definitions/ca.IntermediateObject'
    type: object
  helper.HTTPWrapErrorResponse:
    properties:
      errCode:
        type: string
      msg:
        type: string
    type: object
  helper.MSPNormalizeHTTPResponseBody:
    properties:
      code:
        type: integer
      data: {}
      message:
        type: string
    type: object
  helper.MSPNormalizeList:
    properties:
      list: {}
      paginate:
        $ref: '#/definitions/helper.MSPNormalizePaginate'
    type: object
  helper.MSPNormalizePaginate:
    properties:
      current:
        type: integer
      pageSize:
        type: integer
      total:
        type: integer
    type: object
  schema.CaMetadata:
    properties:
      o:
        type: string
      ou:
        type: string
      spiffe_id:
        $ref: '#/definitions/spiffe.IDGIdentity'
    type: object
  schema.Certificate:
    properties:
      authority_key_id:
        type: string
      issuer:
        type: object
      not_after:
        type: string
      not_before:
        type: string
      sans:
        items:
          type: string
        type: array
      serial_number:
        type: string
      sigalg:
        type: string
      subject:
        type: object
      subject_key_id:
        type: string
    type: object
  schema.FullCert:
    properties:
      aki:
        type: string
      cert_info:
        $ref: '#/definitions/schema.Certificate'
      cert_str:
        description: 展示证书的详细信息
        type: string
      cn:
        type: string
      expiry:
        type: string
      issued_at:
        type: string
      not_before:
        type: string
      o:
        type: string
      ou:
        type: string
      revoked_at:
        type: string
      role:
        type: string
      sn:
        type: string
      status:
        example: good
        type: string
      unique_id:
        type: string
    type: object
  schema.SampleCert:
    properties:
      aki:
        type: string
      cn:
        type: string
      expiry:
        type: string
      issued_at:
        type: string
      not_before:
        type: string
      o:
        type: string
      ou:
        type: string
      revoked_at:
        type: string
      role:
        type: string
      sn:
        type: string
      status:
        example: good
        type: string
      unique_id:
        type: string
    type: object
  spiffe.IDGIdentity:
    properties:
      cluster_id:
        type: string
      site_id:
        type: string
      unique_id:
        type: string
    type: object
  workload.ForbidNewCertsParams:
    properties:
      unique_ids:
        items:
          type: string
        type: array
    type: object
  workload.ForbidUnitParams:
    properties:
      unique_id:
        type: string
    required:
    - unique_id
    type: object
  workload.RecoverCertsParams:
    properties:
      aki:
        type: string
      sn:
        type: string
      unique_id:
        type: string
    type: object
  workload.RevokeCertsParams:
    properties:
      aki:
        type: string
      sn:
        type: string
      unique_id:
        type: string
    type: object
  workload.UnitForbidQueryItem:
    properties:
      forbid:
        type: boolean
      unique_id:
        type: string
    type: object
  workload.UnitsCertsItem:
    properties:
      certs:
        items:
          $ref: '#/definitions/schema.FullCert'
        type: array
      forbidden:
        type: boolean
      unique_id:
        type: string
    type: object
  workload.UnitsForbidQueryResult:
    properties:
      status:
        additionalProperties:
          $ref: '#/definitions/workload.UnitForbidQueryItem'
        type: object
    type: object
  workload.UnitsStatusReq:
    properties:
      unique_ids:
        items:
          type: string
        type: array
    required:
    - unique_ids
    type: object
info:
  contact: {}
paths:
  /ca/intermediate_topology:
    get:
      description: 子CA拓扑
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/ca.IntermediateObject'
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: 子CA拓扑
      tags:
      - CA
  /ca/overall_certs_count:
    get:
      description: 证书总数、根据分类划分的数量、对应服务数量
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/ca.OverallCertsCountResponse'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p2)证书分类
      tags:
      - CA
  /ca/overall_expiry_certs:
    get:
      description: 证书已过期数量, 一周内过期数量, 1/3个月内过期数量, 3个月后过期数量
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/ca.OverallExpiryCertsResponse'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p2)证书有效期
      tags:
      - CA
  /ca/overall_units_enable_status:
    get:
      description: 已启用总数, 禁用总数, 对应服务数
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/ca.OverallUnitsEnableStatus'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p2)启用情况
      tags:
      - CA
  /ca/role_profiles:
    get:
      description: 环境隔离类型
      parameters:
      - description: 只返回类型列表, 供搜索条件
        in: query
        name: short
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  items:
                    type: string
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)环境隔离类型
      tags:
      - CA
  /ca/upper_ca_intermediate_topology:
    get:
      description: 上层CA拓扑
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/ca.IntermediateObject'
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: 上层CA拓扑
      tags:
      - CA
  /ca/workload_units:
    get:
      description: CA 下 Units
      parameters:
      - description: 页数, 默认1
        in: query
        name: page
        type: integer
      - description: 页数限制, 默认20
        in: query
        name: limit_num
        type: integer
      - description: UniqueID 查询
        in: query
        name: unique_id
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  allOf:
                  - $ref: '#/definitions/helper.MSPNormalizeList'
                  - properties:
                      list:
                        items:
                          $ref: '#/definitions/ca.WorkloadUnit'
                        type: array
                    type: object
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)服务单元
      tags:
      - CA
  /certleaf/cert_chain:
    get:
      description: 获取证书链信息
      parameters:
      - description: 展示 CA 自身证书链
        in: query
        name: self_cert
        type: boolean
      - description: SN+AKI 查询指定证书
        in: query
        name: sn
        type: string
      - description: SN+AKI 查询指定证书
        in: query
        name: aki
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/certleaf.LeafCert'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)CertChain
      tags:
      - certleaf
  /certleaf/cert_chain_from_root:
    get:
      description: Root视角下所有证书链
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/certleaf.RootCertChains'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)根视角证书链
      tags:
      - certleaf
  /workload/cert:
    get:
      description: 证书详情
      parameters:
      - description: 证书 sn
        in: query
        name: sn
        required: true
        type: string
      - description: 证书 aki
        in: query
        name: aki
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/schema.FullCert'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: Detail
      tags:
      - Workload
  /workload/certs:
    get:
      description: 证书列表
      parameters:
      - description: 证书类型 gateway/sidecar/standalone
        in: query
        name: role
        type: string
      - description: 根据UniqueID查询
        in: query
        name: unique_id
        type: string
      - description: 根据证书序列号查询
        in: query
        name: cert_sn
        type: string
      - description: 证书状态 good/revoked
        in: query
        name: status
        type: string
      - description: 排序，默认 issued_at desc
        in: query
        name: order
        type: string
      - description: 过期, 起始时间点
        in: query
        name: expiry_start_time
        type: string
      - description: 过期, 结束时间点
        in: query
        name: expiry_end_time
        type: string
      - description: 分页参数, 默认 20
        in: query
        name: limit_num
        type: integer
      - description: 页数, 默认 1
        in: query
        name: page
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  allOf:
                  - $ref: '#/definitions/helper.MSPNormalizeList'
                  - properties:
                      list:
                        items:
                          $ref: '#/definitions/schema.SampleCert'
                        type: array
                    type: object
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p3)List
      tags:
      - Workload
  /workload/lifecycle/forbid_new_certs:
    post:
      description: 禁止某个 UniqueID 申请证书
      parameters:
      - description: ' '
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/workload.ForbidNewCertsParams'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: 禁止申请证书
      tags:
      - Workload
  /workload/lifecycle/forbid_unit:
    post:
      description: 吊销并禁止服务证书
      parameters:
      - description: ' '
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/workload.ForbidUnitParams'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)吊销并禁止服务证书
      tags:
      - Workload
  /workload/lifecycle/recover:
    post:
      description: 恢复证书
      parameters:
      - description: sn+aki / unique_id 二选一
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/workload.RecoverCertsParams'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p3)Recover
      tags:
      - Workload
  /workload/lifecycle/recover_forbid_new_certs:
    post:
      description: 恢复允许某个 UniqueID 申请证书
      parameters:
      - description: ' '
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/workload.ForbidNewCertsParams'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: 恢复申请证书
      tags:
      - Workload
  /workload/lifecycle/recover_unit:
    post:
      description: 恢复并允许服务证书
      parameters:
      - description: ' '
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/workload.ForbidUnitParams'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)恢复并允许服务证书
      tags:
      - Workload
  /workload/lifecycle/revoke:
    post:
      description: 吊销证书
      parameters:
      - description: sn+aki / unique_id 二选一
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/workload.RevokeCertsParams'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p3)Revoke
      tags:
      - Workload
  /workload/units_certs_list:
    get:
      description: 服务证书列表
      parameters:
      - description: 查询 unique_id
        in: query
        name: unique_id
        type: string
      - description: 证书类型
        in: query
        name: role
        type: string
      - description: 过期, 起始时间点
        in: query
        name: expiry_start_time
        type: string
      - description: 过期, 结束时间点
        in: query
        name: expiry_end_time
        type: string
      - description: 是否禁用, 1禁用 2启用
        in: query
        name: is_forbid
        type: integer
      - description: 分页参数, 默认 20
        in: query
        name: limit_num
        type: integer
      - description: 页数, 默认 1
        in: query
        name: page
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/workload.UnitsCertsItem'
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)服务证书列表
      tags:
      - Workload
  /workload/units_forbid_query:
    get:
      description: 查询 unique_id 是否被禁止申请证书
      parameters:
      - collectionFormat: multi
        description: 查询 unique_id 数组
        in: query
        items:
          type: string
        name: unique_ids
        required: true
        type: array
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  $ref: '#/definitions/workload.UnitsForbidQueryResult'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: 禁止申请证书查询
      tags:
      - Workload
  /workload/units_status:
    post:
      description: 服务对应状态查询
      parameters:
      - description: 查询 unique_id 数组
        in: body
        name: json
        required: true
        schema:
          $ref: '#/definitions/workload.UnitsStatusReq'
      produces:
      - application/json
      responses:
        "200":
          description: ' '
          schema:
            allOf:
            - $ref: '#/definitions/helper.MSPNormalizeHTTPResponseBody'
            - properties:
                data:
                  type: object
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/helper.HTTPWrapErrorResponse'
      summary: (p1)服务对应状态查询
      tags:
      - Workload
swagger: "2.0"
